---
import { getLocaleByPath, getRelativeLocaleUrl } from "astro:i18n";
import HeaderLink from "./HeaderLink.astro";
import { Icon } from "astro-icon/components";
import LanguageSelector from "./svelte/LanguageSelector.svelte";

const locale = Astro.currentLocale || getLocaleByPath(Astro.url.pathname);

// localed
const productsURL = getRelativeLocaleUrl(locale, "products");
const aboutURL = getRelativeLocaleUrl(locale, "about");
const contactURL = getRelativeLocaleUrl(locale, "contact");
const homeURL = getRelativeLocaleUrl(locale, "/");
const currentPath = Astro.url.pathname;

const items = [
	{
		label: "English",
		value: "en",
		href: currentPath.replace(/\/(en|ar)\/?/g, "/en/")
	},
	{
		label: "العربية",
		value: "ar",
		href: currentPath.replace(/\/(en|ar)\/?/g, "/ar/")
	}
];
---

<header
	class="flex flex-row-reverse gap-8 w-full justify-between items-center p-8 border-b-2 border-skin-base shadow-2xl z-20 filter backdrop-blur-lg sticky top-0"
	dir={locale === "en" ? "ltr" : "rtl"}
	id="header"
>
	<!-- <img src="/" alt="Machlist logo" /> -->

	{
		locale === "en" ? (
			<>
				<a href="/en" class="text-[3rem] min-w-max">
					Machlist
				</a>
				<nav class="w-max flex py-4 px-2 gap-4 justify-start items-center overflow-x-auto overflow-y-visible whitespace-nowrap">
					<HeaderLink
						highlighted={currentPath == homeURL}
						link={homeURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-home" />
							Homepage
						</span>
					</HeaderLink>
					<HeaderLink
						highlighted={currentPath.includes(productsURL)}
						link={productsURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-shopping-cart" />
							Products
						</span>
					</HeaderLink>
					<HeaderLink
						highlighted={currentPath.includes(aboutURL)}
						link={aboutURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-info" />
							About Us
						</span>
					</HeaderLink>
					<HeaderLink
						highlighted={currentPath.includes(contactURL)}
						link={contactURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-contact-support" />
							Contact us
						</span>
					</HeaderLink>
					<div class="px-4 py-2 w-[15rem] text-3xl text-nowrap min-w-[13rem] rounded-md transition-all duration-150">
						<LanguageSelector
							client:visible
							locale={locale}
							items={items}
						>
							<span slot="check">
								<Icon name="ic:round-check" />
							</span>
							<Icon name="ic:outline-keyboard-double-arrow-down" />
						</LanguageSelector>
					</div>
				</nav>
			</>
		) : (
			<>
				<a href="/ar" class="text-[3rem] min-w-max">
					ماك-ليست
				</a>
				<nav class="w-max flex py-4 px-2 gap-4 justify-start items-center overflow-x-auto overflow-y-visible whitespace-nowrap">
					<HeaderLink
						highlighted={currentPath == homeURL}
						link={homeURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-home" />
							الصفحة الرئيسية
						</span>
					</HeaderLink>
					<HeaderLink
						highlighted={currentPath.includes(productsURL)}
						link={productsURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-shopping-cart" />
							منتجاتنا
						</span>
					</HeaderLink>
					<HeaderLink
						highlighted={currentPath.includes(aboutURL)}
						link={aboutURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-info" />
							عنّا
						</span>
					</HeaderLink>
					<HeaderLink
						highlighted={currentPath.includes(contactURL)}
						link={contactURL}
					>
						<span class="flex gap-2">
							<Icon name="ic:twotone-contact-support" />
							اتصل بنا
						</span>
					</HeaderLink>
					<div class="px-4 py-2 text-3xl text-nowrap min-w-max rounded-md transition-all duration-150">
						<LanguageSelector
							client:visible
							locale={locale}
							items={items}
						>
							<span slot="check">
								<Icon name="ic:round-check" />
							</span>
							<Icon name="ic:outline-keyboard-double-arrow-down" />
						</LanguageSelector>
					</div>
				</nav>
			</>
		)
	}
</header>

<script is:inline>
	const header = document.querySelector("header");
	let prevScrollY = window.scrollY;
	let dy = 0;

	window.addEventListener("scroll", () => {
		dy = prevScrollY - window.scrollY;

		if (dy > 0) {
			header.classList.add("scrolled-up");
			header.classList.remove("scrolled-down");
		} else if (window.scrollY > window.innerHeight * 0.2) {
			header.classList.add("scrolled-down");
			header.classList.remove("scrolled-up");
		}

		prevScrollY = window.scrollY;
	});
</script>

<style>
	header {
		background: hsla(var(--color-primary), 0.8);
		border-bottom: 2px solid hsl(var(--color-primary));
		border-image-slice: 1;
		border-image-source: linear-gradient(
			90deg,
			hsl(var(--color-accent)),
			hsl(var(--color-accent-1))
		);
		transition: all 0.3s ease-in-out;
	}
	header.scrolled-up {
		transform: translateY(0);
	}
	header.scrolled-down {
		transform: translateY(-100%);
	}
	header::before {
		content: "";
		background-image: url(/grain.png);
		background-size: contain;
		filter: brightness(10%);
		opacity: 0.2;
		position: absolute;
		inset: 0;
		z-index: -1;
		mask-image: linear-gradient(45deg, #000a, transparent);
	}
</style>
